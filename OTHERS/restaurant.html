<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Restaurant- Santa Clara Menus</title>
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap0.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i">
    <link rel="stylesheet" href="../assets/fonts/simple-line-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css">
    <link rel="stylesheet" href="../assets/css/smoothproducts.css">
</head>

<body>
    <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-white clean-navbar">
      <div class="container"><a class="navbar-brand logo" href="#">Santa Clara Menus</a><button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
          <div class="collapse navbar-collapse"
              id="navcol-1">
              <ul class="nav navbar-nav ml-auto">
                  <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                  <li class="nav-item"><a class="nav-link active" href="product-page.html">Client_Side_Name_holder</a></li>
                  <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
                  <li class="nav-item"><a class="nav-link" href="registration.html">Register</a></li>
              </ul>
          </div>
      </div>
    </nav>
    <main class="page login-page" style="height:100%">
        <section class="clean-block clean-form dark" style="min-height: 100%">
            <div class="container">
                <div class="block-heading" style="margin-left:auto;margin-right:auto">
                  <h2 class="text-info" style="display:inline-block">Welcome</h2>
                  <h2 class="text-info" style="display:inline-block">[RestaurantUserName]</h2>
                </div>
                <form style="max-width:75%">
                    <div class="form-group" style="display:flex; flex-flow: row warp; align-items: center">
                      <label for="status" style="margin-right:5%">Client address:</label>
                      <input class="form-control form-control-lg" type="text" id="clientAddress" name="clientAddress" style="width: 400px">
                      <button class="btn btn-primary" style=" height: calc(1.5em + .75rem + 2px); margin-left: 50px" type="submit" onclick="getCost(event)">Calculate Cost</button>
                    </div>

                    <div class="form-group" style="display:flex; flex-flow: row warp; align-items: center">
                      <label for="status" style="margin-right:5%">Cost:</label>
                      <h6 class="status" id="cost" style="display:inline-block; color:#343a40">$0.00</h6>
                      <button class="btn btn-primary" style=" height: calc(1.5em + .75rem + 2px); margin-left: 40px" type="submit" onclick="requestdriver(event)">Request</button>
                    </div>

                    <div style="display:inline-block">
                      <span style="margin-right: 20px">Current deliveries:</span>
                    </div>
                    <table class="table table-bordered" id="deliveries">
                      <thead>
                        <tr>
                            <th>Delivery</th>
                            <th>Address</th>
                            <th>Order</th>
                            <th>Total Cost</th>
                        </tr>
                      </thead>
                      <tbody>
                      <tr>
                        <th scope="row">1</th>
                        <td> </td>
                        <td></td>
                        <td></td>
                      </tr>
                      <tr>
                        <th scope="row">2</th>
                        <td></td>
                        <td></td>
                        <td></td>
                      </tr>
                      </tbody>
                    </table>
                    </form>
            </div>
        </section>
    </main>
    <script>

        function getCost(e){
            e.preventDefault();
            var address = document.getElementById("clientAddress").value;
            var xhttp = new XMLHttpRequest();

            xhttp.open("POST", "/app/api.php/restaurant/inquiry", true);
            xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhttp.onload= function(){
              const data = xhttp.responseText;
              var response = JSON.parse(xhttp.responseText);
              //to do
              $("#cost").text("$10");//pass in real data from the response
              console.log(data);
            };
            // xhttp.onreadystatechange= function(){
            //   if(this.readyState == XMLHttpRequest.DONE && this.status == 200)
            //   {
            //     const data = xhttp.responseText;
            //     var response = JSON.parse(xhttp.responseText);
            //     //to do
            //     console.log(data);
            //   }
            //   else{
            //     alert("Invalid response");
            //     console.log(xhttp);
            //   }
            // };

            xhttp.send(encodeURIComponent("address=" + address));
        }

        setInterval(getStatus,5000);
        function getStatus(e){
            if (e) {
              e.preventDefault();
            }
            var xhttp = new XMLHttpRequest();

            xhttp.open("GET", "/app/api.php/restaurant", true);

            xhttp.onload = () => {
                const data = xhttp.responseText;
                var response = JSON.parse(xhttp.responseText);
                //to do
                $("#deliveries tbody").empty();
                $('#deliveries tbody').append("<tr><th scope=\"row\">1</th> <td> </td><td> </td><td> </td></tr>");//when real data is avaiable change this
                console.log(data);
            };

            xhttp.send();
        }
        function requestdriver(e){
            e.preventDefault();
            var xhttp = new XMLHttpRequest();
            var address = document.getElementById("clientAddress").value;
            xhttp.open("POST", "/app/api.php/restaurant/request", true);
            xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhttp.onload= function(){
              const data = xhttp.responseText;
              var response = JSON.parse(xhttp.responseText);
              //to do
              console.log(data);
            };
            // xhttp.onreadystatechange= function(){
            //   if(this.readyState == XMLHttpRequest.DONE && this.status == 200)
            //   {
            //     const data = xhttp.responseText;
            //     var response = JSON.parse(xhttp.responseText);
            //     //to do
            //     console.log(data);
            //   }
            //   else{
            //     alert("Invalid response");
            //     console.log(xhttp);
            //   }
            // };

            xhttp.send(encodeURIComponent("address=" + address));

        }
    </script>
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.js"></script>
    <script src="../assets/js/smoothproducts.min.js"></script>
    <script src="../assets/js/theme.js"></script>
</body>

</html>
